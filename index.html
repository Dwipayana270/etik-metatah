<!DOCTYPE html>
<html
  lang="id"
  x-data="invitationApp()"
  :class="{'no-scroll': showModal || showLightbox}"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Undangan Metatah — Undangan Online Bali</title>
    <meta
      name="description"
      content="Undangan Metatah (Potong Gigi) — undangan online bertema Bali, single-file, campuran modern & tradisional."
    />
    <meta
      property="og:title"
      content="Undangan Metatah — Undangan Online Bali"
    />
    <meta
      property="og:description"
      content="Undangan Metatah (Potong Gigi) — undangan online bertema Bali."
    />
    <meta property="og:image" content="https://picsum.photos/1200/630" />
    <meta name="theme-color" content="#f3f4f6" />
    <link rel="icon" href="svgviewer-output.svg" />

    <!-- Supabase (optional) - set these to enable cloud storage -->
    <meta
      name="supabase-url"
      content="https://fnumtldvzzcldzuevnhd.supabase.co"
    />
    <meta
      name="supabase-anon-key"
      content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZudW10bGR2enpjbGR6dWV2bmhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwMzgwMTMsImV4cCI6MjA3NTYxNDAxM30.5QyP3aLMTnk3WXrxif3ufqBWWv4QXEPoL68gGCCbJkE"
    />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Supabase JS (optional) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Mrs+Saint+Delafield&family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Ysabeau+Infant:ital,wght@0,1..1000;1,1..1000&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              playfair: ["Playfair Display", "serif"],
              montserrat: ["Montserrat", "sans-serif"],
              mrsdelafield: ['"Mrs Saint Delafield"', "cursive"],
            },
            colors: {
              "primary-light": "#f3f4f6", // gray-100
              primary: "#e5e7eb", // gray-200
              secondary: "#6b7280", // gray-600
              "secondary-light": "#9ca3af", // gray-400
              "secondary-dark": "#374151", // gray-700
              "text-primary": "#374151", // gray-700
              accent: "rgba(107, 114, 128, 0.2)", // gray-600 @ 0.2
            },
          },
        },
      };
    </script>

    <style>
      html,
      body {
        overflow-x: hidden;
        /* Prevent rubber-band overscroll affecting layout calculations */
        overscroll-behavior-y: none;
      }

      :root {
        /* Theme colors mapped to CSS variables for semantic use */
        --color-primary-light: #f3f4f6;
        /* gray-100 */
        --color-primary: #e5e7eb;
        /* gray-200 */
        --color-secondary: #6b7280;
        /* gray-600 */
        --color-secondary-light: #9ca3af;
        /* gray-400 */
        --color-secondary-dark: #374151;
        /* gray-700 */
        --color-text-primary: #374151;
        /* gray-700 */
        --color-accent: rgba(107, 114, 128, 0.2);
        /* gray-600 @ 0.2 */

        /* RGB components for alpha compositions */
        --color-primary-light-rgb: 243, 244, 246;
        /* gray-100 */
        --color-primary-rgb: 229, 231, 235;
        /* gray-200 */
        --color-secondary-rgb: 107, 114, 128;
        /* gray-600 */
        --color-secondary-light-rgb: 156, 163, 175;
        /* gray-400 */
        --color-secondary-dark-rgb: 55, 65, 81;
        /* gray-700 */
        --color-text-primary-rgb: 55, 65, 81;
        /* gray-700 */
        --color-accent-rgb: 107, 114, 128;
        /* gray-600 */

        /* Neutrals */
        --color-white: #ffffff;
        --color-white-rgb: 255, 255, 255;
        --color-black-rgb: 0, 0, 0;
      }

      body {
        background-color: var(--color-white);
        background-image: url("https://www.transparenttextures.com/patterns/paper-fibers.png");
        background-size: auto;
        background-attachment: fixed;
        background-repeat: repeat;
        color: var(--color-text-primary);
      }

      .parallax-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        /* Prefer stable viewport height to avoid address bar resize jumps */
        height: 100vh; /* fallback */
        height: 100svh; /* stable on mobile */
        pointer-events: none;
        z-index: 1;
        overflow: hidden;
      }

      .parallax-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        will-change: transform;
        backface-visibility: hidden;
      }

      .square {
        position: absolute;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        will-change: transform;
        /* keep transforms on GPU and avoid layout thrash */
        transform: translateZ(0);
        transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }

      .square-left {
        left: -8vw;
        max-width: 100vw;
      }

      .square-right {
        right: -8vw;
        max-width: 100vw;
      }

      .back-layer .square {
        width: clamp(180px, 30vw, 400px);
        height: clamp(180px, 30vw, 400px);
        opacity: 0.12;
      }

      .front-layer .square {
        width: clamp(120px, 20vw, 260px);
        height: clamp(120px, 20vw, 260px);
        opacity: 0.15;
        transform: none;
      }

      /* Waving animation for parallax elements - FASTER */
      @keyframes wave {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        25% {
          transform: translateY(-15px) rotate(3deg);
        }
        50% {
          transform: translateY(0) rotate(0deg);
        }
        75% {
          transform: translateY(15px) rotate(-3deg);
        }
      }

      @keyframes wave-reverse {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        25% {
          transform: translateY(15px) rotate(-3deg);
        }
        50% {
          transform: translateY(0) rotate(0deg);
        }
        75% {
          transform: translateY(-15px) rotate(3deg);
        }
      }

      .back-layer .square-left {
        animation: wave 6s ease-in-out infinite;
      }

      .back-layer .square-right {
        animation: wave-reverse 7s ease-in-out infinite;
      }

      .front-layer .square-left {
        animation: wave-reverse 5s ease-in-out infinite;
      }

      .front-layer .square-right {
        animation: wave 5.5s ease-in-out infinite;
      }

      @media (max-width: 768px) {
        .square-left {
          left: -15vw;
          max-width: 100vw;
        }

        .square-right {
          right: -15vw;
          max-width: 100vw;
        }

        .back-layer .square {
          width: clamp(180px, 52vw, 360px);
          height: clamp(180px, 52vw, 360px);
        }

        .front-layer .square {
          width: clamp(130px, 42vw, 280px);
          height: clamp(130px, 42vw, 280px);
        }
      }

      /* Additional styles for content from code A */
      .modal-overlay {
        background: transparent;
      }

      .countdown-item {
        background: #e0d6bd;
        border-radius: 10px;
        padding: 10px;
        flex: 1 1 0%;
        min-width: 0;
      }

      .nav-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: var(--color-text-primary);
        transition: color 0.2s ease;
      }

      .nav-btn:hover {
        color: var(--color-secondary);
      }

      a:focus,
      button:focus,
      input:focus,
      textarea:focus {
        outline: 3px solid rgba(var(--color-accent-rgb), 0.25);
        outline-offset: 2px;
      }

      @media (max-width: 640px) {
        .countdown-item {
          padding: 8px;
          flex: 1 1 0%;
          min-width: 0;
        }
      }

      /* Blur effect when modal is open */
      .blur-content {
        filter: blur(5px);
        pointer-events: none;
      }

      /* Disable scroll */
      .no-scroll {
        overflow: hidden;
      }

      /* Full-width accent transparent section */
      .full-width-accent {
        background-color: var(--color-accent);
        position: relative;
        /* Robust viewport breakout (prevents overflow and centers content) */
        left: 50%;
        right: 50%;
        /* Fallbacks for older browsers */
        width: 100vw;
        margin-left: -50vw;
        margin-right: -50vw;
      }

      /* Prefer dynamic viewport units when supported to avoid double scrollbars */
      @supports (width: 100dvw) {
        .full-width-accent {
          width: 100dvw;
          margin-left: -50dvw;
          margin-right: -50dvw;
        }
      }

      /* Fixed curved divider */
      .curved-divider {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100px;
        overflow: hidden;
        transform: translateY(-100%);
      }

      .curved-divider::after {
        content: "";
        border-top-left-radius: 50% 100%;
        border-top-right-radius: 50% 100%;
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        background: var(--color-accent);
        height: 66%;
      }

      /* Gallery Styles - Fixed for perfect infinite loop */
      .gallery-track {
        display: flex;
        gap: 1rem;
        width: max(100%, fit-content);
        will-change: transform;
      }

      @keyframes scroll-left {
        0% {
          transform: translateX(0);
        }

        100% {
          transform: translateX(-50%);
        }
      }

      @keyframes scroll-right {
        0% {
          transform: translateX(-50%);
        }

        100% {
          transform: translateX(0);
        }
      }

      .scroll-left {
        animation: scroll-left 80s linear infinite;
      }

      .scroll-right {
        animation: scroll-right 80s linear infinite;
      }

      .fade-left,
      .fade-right {
        position: absolute;
        top: 0;
        width: 80px;
        height: 100%;
        z-index: 20;
        pointer-events: none;
      }

      .fade-left {
        left: 0;
        background: linear-gradient(
          to right,
          rgba(var(--color-primary-light-rgb), 0.8),
          transparent
        );
      }

      .fade-right {
        right: 0;
        background: linear-gradient(
          to left,
          rgba(var(--color-primary-light-rgb), 0.8),
          transparent
        );
      }

      /* Lightbox - Fixed styles */
      #lightbox {
        display: none;
      }

      #lightbox.active {
        display: flex;
      }

      .lightbox-nav-btn {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(var(--color-black-rgb), 0.5);
        color: var(--color-white);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition: background 0.3s;
      }

      .lightbox-nav-btn:hover {
        background: rgba(var(--color-black-rgb), 0.8);
      }

      .lightbox-prev {
        left: 20px;
      }

      .lightbox-next {
        right: 20px;
      }

      /* Comments scroll container */
      .comments-container {
        max-height: none;
        overflow-y: visible;
        padding-right: 0;
      }

      /* Make comments scrollable when content exceeds threshold */
      .comments-container.scrollable {
        max-height: 420px;
        overflow-y: auto;
        padding-right: 0.5rem; /* preserve content width when scrollbar shows */
      }

      .comments-container::-webkit-scrollbar {
        width: 6px;
      }

      .comments-container::-webkit-scrollbar-track {
        background: rgba(var(--color-primary-rgb), 0.2);
        border-radius: 10px;
      }

      .comments-container::-webkit-scrollbar-thumb {
        background: rgba(var(--color-secondary-rgb), 0.5);
        border-radius: 10px;
      }

      .comments-container::-webkit-scrollbar-thumb:hover {
        background: rgba(var(--color-secondary-rgb), 0.7);
      }

      /* Box styling for Info Acara section */
      .box {
        position: relative;
        background-color: rgba(var(--color-primary-light-rgb), 0.7);
        width: 100%;
        max-width: 600px;
        padding: 5px;
        border: 2px solid var(--color-secondary);
        margin: 0 auto;
      }

      .box:before,
      .box:after {
        content: "•";
        position: absolute;
        width: 14px;
        height: 14px;
        font-size: 14px;
        color: var(--color-secondary);
        border: 2px solid var(--color-secondary);
        line-height: 12px;
        top: 5px;
        text-align: center;
      }

      .box:before {
        left: 5px;
      }

      .box:after {
        right: 5px;
      }

      .box-inner {
        position: relative;
        border: 2px solid var(--color-secondary);
        padding: 40px;
      }

      .box-inner:before,
      .box-inner:after {
        content: "•";
        position: absolute;
        width: 14px;
        height: 14px;
        font-size: 14px;
        color: var(--color-secondary);
        border: 2px solid var(--color-secondary);
        line-height: 12px;
        bottom: -2px;
        text-align: center;
      }

      .box-inner:before {
        left: -2px;
      }

      .box-inner:after {
        right: -2px;
      }

      @media (max-width: 768px) {
        img.h-48 {
          height: 6rem;
        }

        h2 {
          font-size: 1.5rem;
        }

        p {
          font-size: 0.9rem;
        }

        .lightbox-nav-btn {
          width: 40px;
          height: 40px;
        }

        .lightbox-prev {
          left: 10px;
        }

        .lightbox-next {
          right: 10px;
        }

        .comments-container {
          max-height: none;
        }
        .comments-container.scrollable {
          max-height: 360px;
        }

        .box-inner {
          padding: 20px;
        }
      }

      .ysabeau-infant {
        font-family: "Ysabeau Infant", sans-serif;
        font-optical-sizing: auto;
        font-style: normal;
      }
    </style>
  </head>

  <body
    class="font-montserrat overflow-x-hidden relative text-text-primary"
    :class="{'no-scroll': showModal}"
  >
    <div class="parallax-container">
      <div class="parallax-layer back-layer z-10" data-speed="0.15"></div>
      <div class="parallax-layer front-layer z-20" data-speed="0.2"></div>
    </div>

    <!-- Modal Background Gallery (between modal and main web) -->
    <div
      x-show="showModal"
      class="fixed inset-0 z-[45] pointer-events-none"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      style="display: none"
      aria-hidden="true"
    >
      <template x-for="image in galleryImages" :key="'modalbg-'+image">
        <img
          :src="image"
          alt=""
          class="absolute inset-0 w-full h-full object-cover object-center transition-opacity duration-500"
          :class="galleryImages.indexOf(image) === modalBgIndex ? 'opacity-100' : 'opacity-0'"
          loading="lazy"
          decoding="async"
          @error="$event.target.src = 'https://picsum.photos/800/800?' + (galleryImages.indexOf(image) + 1)"
        />
      </template>
      <div class="absolute inset-0 bg-black/60"></div>
    </div>

    <!-- Modal Pembuka -->
    <div
      x-show="showModal"
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0"
      x-transition:enter-end="opacity-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100"
      x-transition:leave-end="opacity-0"
      class="fixed inset-0 z-50 flex items-center justify-center modal-overlay"
      style="display: none"
    >
      <div
        class="bg-white/40 backdrop-blur-[5px] rounded-2xl shadow-2xl p-6 max-w-md w-full mx-4 text-center mt-[25%]"
      >
        <h2 class="text-4xl font-mrsdelafield text-secondary-dark mb-1">
          Om Swastyastu
        </h2>
        <p class="text-gray-600 mb-4" x-text="guestGreeting">
          Yth. Bapak/Ibu/Saudara/i
        </p>

        <div class="flex gap-3 justify-center">
          <button
            @click="openInvitation()"
            class="bg-[#E0D6BD] text-gray-700 px-6 py-2 rounded-full shadow hover:shadow-lg transform hover:brightness-[1.05]"
          >
            <i class="far fa-envelope-open mr-2"></i>Buka Undangan
          </button>
        </div>
      </div>
    </div>

    <!-- Audio (start after user interaction) -->
    <audio id="backgroundMusic" loop preload="auto" x-ref="audioPlayer">
      <source src="Canang Ayu.mp3" type="audio/mp3" />
    </audio>

    <!-- Main Content (will be blurred when modal is open) -->
    <div
      id="mainContent"
      :class="{'blur-content': showModal}"
      class="relative z-[10] px-5 max-w-[700px] mx-auto text-center"
    >
      <!-- HERO -->
      <header
        class="min-h-screen min-h-[100svh] flex items-center justify-center"
        style="min-height: 100vh; min-height: 100svh"
      >
        <div class="container mx-auto px-6 text-center">
          <div class="w-full overflow-hidden mb-8">
            <img
              src="https://media-public.canva.com/FnqPo/MAEqEXFnqPo/1/tl.png"
              alt=""
              class="block w-full h-full object-cover filter grayscale"
              aria-hidden="true"
            />
          </div>

          <div data-aos="zoom-in-up" data-aos-duration="900">
            <h1
              class="text-5xl sm:text-7xl md:text-8xl font-mrsdelafield text-secondary-dark"
            >
              Upacara Metatah
            </h1>
            <p
              class="my-3 text-xl md:text-3xl text-gray-700 ysabeau-infant"
              x-text="guestGreeting"
            >
              Yth. Bapak/Ibu/Saudara/i
            </p>
            <p class="mt-2 text-sm text-gray-500 max-w-xl mx-auto">
              Atas Asung Kertha Wara Nugraha Ida Sang Hyang Widhi Wasa,
              perkenankan kami mengundang Bapak/Ibu/Saudara/i hadir memberikan
              doa restu.
            </p>
            <!-- <div class="mt-6 flex flex-row justify-center gap-3">
              <a
                href="#info"
                class="inline-flex items-center justify-center px-6 py-3 text-sm sm:text-base bg-[#E0D6BD] text-gray-700 rounded-full shadow hover:brightness-[1.05] transform whitespace-nowrap"
                >Info Acara</a
              >
              <a
                href="#ucapan"
                class="inline-flex items-center justify-center px-6 py-3 text-sm sm:text-base border border-gray-300 rounded-full text-gray-700 hover:bg-gray-50 whitespace-nowrap"
                >Kirim Ucapan</a
              >
            </div> -->
          </div>

          <!-- Bottom section (divider flipped) -->
          <div class="w-full overflow-hidden mt-8">
            <img
              src="https://media-public.canva.com/FnqPo/MAEqEXFnqPo/1/tl.png"
              alt=""
              class="block w-full h-full object-cover rotate-180 filter grayscale"
              aria-hidden="true"
            />
          </div>
        </div>
      </header>

      <section id="mempelai" class="relative full-width-accent pb-12 sm:pb-16">
        <div class="curved-divider"></div>
        <div class="w-full px-5 sm:px-8">
          <div class="container mx-auto px-6 text-center">
            <div class="text-center mb-6 sm:mb-8" data-aos="fade-up">
              <h2
                class="text-4xl sm:text-5xl md:text-6xl font-mrsdelafield text-secondary-dark"
              >
                Keluarga Yang Berbahagia
              </h2>
              <p class="mt-2 text-gray-600 max-w-2xl mx-auto">
                Merupakan kehormatan jika Bapak/Ibu/Saudara/i berkenan hadir
                memberikan doa restu.
              </p>
            </div>

            <div
              class="grid gid-cols-1 md:grid-cols-2 md:grid-rows-2 gap-4 lg:grid-cols-4 lg:grid-rows-1"
            >
              <!-- Card -->
              <div class="relative overflow-hidden rounded-xl shadow-lg">
                <div
                  class="aspect-square lg:aspect-[3/4] relative"
                  data-aos="fade-up"
                >
                  <img
                    src="assets/mempelai/tia.jpg"
                    alt="Luh Mas Tia Andriani"
                    class="w-full h-full object-cover"
                    onerror="this.onerror=null; this.src='https://picsum.photos/600/800?random=1'"
                  />
                  <div
                    class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-white via-white/80 to-transparent flex items-end justify-center pb-2 sm:pb-6"
                  >
                    <p
                      class="text-2xl md:text-xl text-gray-800 tracking-wide text-center ysabeau-infant"
                    >
                      Luh Mas Tia Andriani
                    </p>
                  </div>
                </div>
              </div>

              <!-- Repeat for others -->
              <div
                data-aos="fade-up"
                data-aos-delay="100"
                class="relative overflow-hidden rounded-xl shadow-lg"
              >
                <div class="aspect-square lg:aspect-[3/4] relative">
                  <img
                    src="assets/mempelai/ita.jpg"
                    alt="Ni Kadek Mas Ita Andriantini"
                    class="w-full h-full object-cover"
                    onerror="this.onerror=null; this.src='https://picsum.photos/600/800?random=2'"
                  />
                  <div
                    class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-white via-white/80 to-transparent flex items-end justify-center pb-2 sm:pb-6"
                  >
                    <p
                      class="text-2xl md:text-xl text-gray-800 tracking-wide text-center ysabeau-infant"
                    >
                      Ni Kadek Mas Ita Andriantini
                    </p>
                  </div>
                </div>
              </div>

              <div
                data-aos="fade-up"
                data-aos-delay="200"
                class="relative overflow-hidden rounded-xl shadow-lg"
              >
                <div class="aspect-square lg:aspect-[3/4] relative">
                  <img
                    src="assets/mempelai/eti.jpg"
                    alt="Komang Mas Eti Andriantina"
                    class="w-full h-full object-cover"
                    onerror="this.onerror=null; this.src='https://picsum.photos/600/800?random=3'"
                  />
                  <div
                    class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-white via-white/80 to-transparent flex items-end justify-center pb-2 sm:pb-6"
                  >
                    <p
                      class="text-2xl md:text-xl text-gray-800 tracking-wide text-center ysabeau-infant"
                    >
                      Komang Mas Eti Andriantina
                    </p>
                  </div>
                </div>
              </div>

              <div
                data-aos="fade-up"
                data-aos-delay="300"
                class="relative overflow-hidden rounded-xl shadow-lg"
              >
                <div class="aspect-square lg:aspect-[3/4] relative">
                  <img
                    src="assets/mempelai/tyo.jpg"
                    alt="Ketut Mas Tyo Teja Adriana"
                    class="w-full h-full object-cover"
                    onerror="this.onerror=null; this.src='https://picsum.photos/600/800?random=4'"
                  />
                  <div
                    class="absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-white via-white/80 to-transparent flex items-end justify-center pb-2 sm:pb-6"
                  >
                    <p
                      class="text-2xl md:text-xl text-gray-800 tracking-wide text-center ysabeau-infant"
                    >
                      Ketut Mas Tyo Teja Adriana
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Shared parents info (moved from individual cards) -->
            <div class="mt-6 sm:mt-8 box" data-aos="fade-up">
              <div class="box-inner p-4 sm:p-6 text-gray-700 text-center">
                <p class="text-sm sm:text-base">Putra Putri dari:</p>
                <div class="mt-3 space-y-3 sm:space-y-4 text-gray-600">
                  <div
                    class="flex flex-col md:flex-row justify-center items-center md:gap-3"
                  >
                    <div class="text-2xl ysabeau-infant">I Nyoman Sumanasa</div>
                    <div
                      class="-mb-4 text-secondary-dark text-6xl sm:text-7xl md:text-8xl leading-none font-mrsdelafield"
                    >
                      &amp;
                    </div>
                    <div class="text-2xl ysabeau-infant">
                      Ketut Santi Purnami
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- INFO ACARA -->
      <section id="info" class="my-6 py-16 bg-primary-light/50">
        <div class="container mx-auto px-6">
          <div class="text-center mb-8" data-aos="fade-up">
            <h2
              class="text-4xl sm:text-5xl md:text-6xl font-mrsdelafield text-secondary-dark"
            >
              Info Acara
            </h2>
            <p class="mt-2 text-gray-600">
              Detail tanggal, waktu, dan lokasi upacara.
            </p>
          </div>

          <div class="box" data-aos="zoom-in">
            <div class="box-inner">
              <div
                class="grid grid-cols-1 md:grid-cols-3 md:gap-6 text-center mb-8"
              >
                <div class="p-4">
                  <div class="text-sm text-gray-500">Hari</div>
                  <div class="text-xl font-bold mt-2">Jumat</div>
                </div>
                <div class="p-4">
                  <div class="text-sm text-gray-500">Tanggal</div>
                  <div class="text-4xl font-bold text-secondary-dark mt-1">
                    24
                  </div>
                  <div class="text-md font-bold mt-1">Oktober 2025</div>
                </div>
                <div class="p-4">
                  <div class="text-sm text-gray-500">Waktu</div>
                  <div class="text-xl font-bold mt-2">10:00 - 16:00 WITA</div>
                </div>
              </div>

              <!-- Countdown -->
              <div class="text-center mb-8">
                <h3 class="text-2xl font-semibold mb-4 ysabeau-infant">
                  Hitung Mundur Acara
                </h3>
                <div class="flex justify-center gap-2 sm:gap-4 flex-nowrap">
                  <div class="countdown-item text-gray-500 text-center">
                    <div
                      class="text-2xl sm:text-3xl font-bold"
                      x-text="countdown.days"
                    >
                      00
                    </div>
                    <div class="text-xs sm:text-sm">Hari</div>
                  </div>
                  <div class="countdown-item text-gray-500 text-center">
                    <div
                      class="text-2xl sm:text-3xl font-bold"
                      x-text="countdown.hours"
                    >
                      00
                    </div>
                    <div class="text-xs sm:text-sm">Jam</div>
                  </div>
                  <div class="countdown-item text-gray-500 text-center">
                    <div
                      class="text-2xl sm:text-3xl font-bold"
                      x-text="countdown.minutes"
                    >
                      00
                    </div>
                    <div class="text-xs sm:text-sm">Menit</div>
                  </div>
                  <div class="countdown-item text-gray-500 text-center">
                    <div
                      class="text-2xl sm:text-3xl font-bold"
                      x-text="countdown.seconds"
                    >
                      00
                    </div>
                    <div class="text-xs sm:text-sm">Detik</div>
                  </div>
                </div>
              </div>

              <!-- Peta -->
              <div>
                <h4
                  class="text-lg font-semibold text-secondary-dark mb-3 ysabeau-infant"
                >
                  Lokasi
                </h4>
                <div class="rounded-xl overflow-hidden shadow">
                  <iframe
                    src="https://www.google.com/maps/embed?pb=!1m17!1m12!1m3!1d3949.0919047446264!2d114.93476507500938!3d-8.193496691838238!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zOMKwMTEnMzYuNiJTIDExNMKwNTYnMTQuNCJF!5e0!3m2!1sid!2sid!4v1760062651936!5m2!1sid!2sid"
                    class="w-full h-64"
                    frameborder="0"
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade"
                    aria-label="Peta lokasi"
                  ></iframe>
                </div>
                <div class="text-center mt-4">
                  <a
                    href="https://maps.app.goo.gl/JyZneH9gKBugatr78"
                    target="_blank"
                    class="bg-[#E0D6BD] text-gray-700 inline-flex items-center gap-2 px-4 py-2 rounded-full border border-gray-300 hover:bg-gray-50"
                  >
                    <i class="fas fa-map-marker-alt"></i> Buka di Google Maps
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- UCAPAN -->
      <section id="ucapan" class="pb-16">
        <div class="container mx-auto px-6 mb-12">
          <div class="text-center mb-8" data-aos="fade-up">
            <blockquote
              class="text-xl italic border-l-4 border-primary pl-4 py-2 mx-auto max-w-2xl"
            >
              "Om Ano Badrah Kretavo Yantu Visvatah" </br> "Semoga pikiran baik datang dari segala penjuru"
              <footer class="text-right mt-2 text-gray-600">
               <i class="fa fa-book" aria-hidden="true"></i> Yajurweda XV.113
              </footer>
            </blockquote>
          </div>

          <div
            class="max-w-2xl mx-auto bg-white/70 backdrop-blur-[10px] rounded-xl shadow p-6"
            data-aos="fade-up"
          >
            <h3 class="text-xl font-semibold mb-4 ysabeau-infant">
              Kirimkan Ucapan & Doa Restu
            </h3>
            <form class="space-y-4" @submit.prevent="submitComment()">
              <input
                type="text"
                x-model="commentForm.name"
                placeholder="Nama"
                required
                class="w-full px-4 py-2 border rounded focus:ring-2 focus:ring-primary"
              />
              <textarea
                x-model="commentForm.message"
                rows="3"
                placeholder="Ucapan"
                required
                class="w-full px-4 py-2 border rounded focus:ring-2 focus:ring-primary"
              ></textarea>
              <select
                x-model="commentForm.attendance"
                class="w-full px-4 py-2 border rounded"
              >
                <option value="">Konfirmasi Kehadiran</option>
                <option value="Hadir">Hadir</option>
                <option value="Tidak Hadir">Tidak Hadir</option>
                <option value="Belum Tahu">Belum Tahu</option>
              </select>

              <div class="flex justify-between items-center">
                <div class="flex gap-3">
                  <button
                    type="submit"
                    class="px-4 py-2 rounded bg-[#E0D6BD] text-gray-700"
                  >
                    Kirim
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Comments Display -->
          <div class="max-w-2xl mx-auto mt-8" data-aos="fade-up">
            <h3 class="text-xl font-semibold mb-4 ysabeau-infant text-center">
              Ucapan & Doa Restu
            </h3>
            <!-- Scroll container for comments (no nested scrolling) -->
            <div
              class="comments-container"
              :class="{'scrollable': comments.length > 4}"
            >
              <div class="space-y-4">
                <template
                  x-for="comment in comments.slice().reverse()"
                  :key="comment.time"
                >
                  <div
                    class="bg-white/70 backdrop-blur-[10px] rounded-xl shadow p-4"
                  >
                    <div class="text-left">
                      <div class="mb-2">
                        <h4
                          class="font-semibold ysabeau-infant text-secondary-dark"
                          x-text="comment.name"
                        ></h4>
                      </div>
                      <p
                        class="text-gray-700 mb-2"
                        x-text="comment.message"
                      ></p>
                      <div class="flex items-center justify-between">
                        <div class="text-sm">
                          <span
                            :class="comment.attendance === 'Hadir' 
                              ? 'bg-green-100 text-green-800' 
                              : (comment.attendance === 'Tidak Hadir' 
                                ? 'bg-red-100 text-red-800' 
                                : 'bg-orange-100 text-orange-800')"
                            class="px-2 py-1 rounded"
                            x-text="comment.attendance || 'Belum Tahu'"
                          ></span>
                        </div>
                        <div class="text-xs text-gray-500">
                          <span
                            x-text="new Date(comment.time).toLocaleDateString('id-ID', { 
                                                    day: 'numeric', 
                                                    month: 'long', 
                                                    year: 'numeric' 
                                                })"
                          ></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>
            <!-- Scroll indicator when there are more than 5 comments -->
            <div
              x-show="comments.length > 4"
              class="text-center mt-2 text-sm text-gray-500"
            >
              <i class="fas fa-arrow-down animate-bounce"></i> Scroll untuk
              melihat lebih banyak
            </div>
          </div>
        </div>
      </section>

      <!-- GALERI -->
      <section id="galeri" class="full-width-accent pb-10 sm:pb-14">
        <div class="curved-divider"></div>
        <div class="w-full px-5 sm:px-8">
          <div class="text-center mb-5 sm:mb-6" data-aos="fade-up">
            <h2
              class="text-4xl sm:text-5xl md:text-6xl font-mrsdelafield text-secondary-dark"
            >
              Galeri
            </h2>
            <p class="text-gray-600">Foto-foto keluarga dan persiapan</p>
          </div>

          <!-- Smooth Scrolling Gallery -->
          <div class="relative overflow-hidden mx-[-1.25rem] sm:mx-[-2rem]">
            <div class="fade-left"></div>
            <div class="fade-right"></div>

            <!-- Row 1 -->
            <div class="relative overflow-hidden">
              <div class="gallery-track scroll-left w-full">
                <!-- First set of images -->
                <template
                  x-for="image in galleryImages.slice(0, 6)"
                  :key="image"
                >
                  <img
                    :src="image"
                    class="h-48 w-auto object-cover rounded-xl cursor-pointer hover:opacity-80 flex-shrink-0"
                    @click="openLightbox(galleryImages.indexOf(image))"
                    @error="$event.target.src = 'https://picsum.photos/800/800?' + (galleryImages.indexOf(image) + 1)"
                  />
                </template>
                <!-- Duplicated set for seamless loop -->
                <template
                  x-for="image in galleryImages.slice(0, 6)"
                  :key="image + '-dup'"
                >
                  <img
                    :src="image"
                    class="h-48 w-auto object-cover rounded-xl cursor-pointer hover:opacity-80 flex-shrink-0"
                    @click="openLightbox(galleryImages.indexOf(image))"
                    @error="$event.target.src = 'https://picsum.photos/800/800?' + (galleryImages.indexOf(image) + 1)"
                  />
                </template>
              </div>
            </div>

            <!-- Row 2 (reverse) -->
            <div class="relative overflow-hidden mt-6">
              <div class="gallery-track scroll-right w-full">
                <template
                  x-for="image in galleryImages.slice(6, 12)"
                  :key="image"
                >
                  <img
                    :src="image"
                    class="h-48 w-auto object-cover rounded-xl cursor-pointer hover:opacity-80 flex-shrink-0"
                    @click="openLightbox(galleryImages.indexOf(image))"
                    @error="$event.target.src = 'https://picsum.photos/800/800?' + (galleryImages.indexOf(image) + 1)"
                  />
                </template>
                <!-- Duplicated set for seamless loop -->
                <template
                  x-for="image in galleryImages.slice(6, 12)"
                  :key="image + '-dup'"
                >
                  <img
                    :src="image"
                    class="h-48 w-auto object-cover rounded-xl cursor-pointer hover:opacity-80 flex-shrink-0"
                    @click="openLightbox(galleryImages.indexOf(image))"
                    @error="$event.target.src = 'https://picsum.photos/800/800?' + (galleryImages.indexOf(image) + 1)"
                  />
                </template>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- STICKY NAV -->
      <nav
        class="fixed bottom-0 left-0 w-full bg-white/20 backdrop-blur-sm shadow-lg z-40"
      >
        <div class="container mx-auto px-6 py-3">
          <div class="flex justify-around">
            <a href="#info" class="nav-btn"
              ><i class="far fa-calendar-alt"></i
              ><span class="text-xs">Tanggal</span></a
            >
            <a href="#galeri" class="nav-btn"
              ><i class="fas fa-image"></i
              ><span class="text-xs">Galeri</span></a
            >
            <button
              @click="toggleAudio()"
              class="nav-btn"
              :aria-pressed="isPlaying"
            >
              <i :class="isPlaying ? 'fas fa-pause' : 'fas fa-music'"></i
              ><span class="text-xs">Music</span>
            </button>
          </div>
        </div>
      </nav>

      <!-- LIGHTBOX - Fixed -->
      <div
        x-show="showLightbox"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        @click.away="closeLightbox()"
        @keydown.escape.window="closeLightbox()"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80"
      >
        <button
          @click="closeLightbox()"
          class="text-white text-2xl absolute top-4 right-4 z-10"
        >
          &times;
        </button>
        <button @click="prevImage()" class="lightbox-nav-btn lightbox-prev">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button @click="nextImage()" class="lightbox-nav-btn lightbox-next">
          <i class="fas fa-chevron-right"></i>
        </button>
        <img
          :src="galleryImages[currentImageIndex]"
          alt="Preview"
          class="rounded-lg max-w-full max-h-full"
          @error="$event.target.src = 'https://picsum.photos/800/800?' + (currentImageIndex + 1)"
        />
      </div>
    </div>

    <script>
      function invitationApp() {
        return {
          showModal: true,
          isPlaying: false, // Changed from true to false
          showLightbox: false,
          currentImageIndex: 0,
          // Background slideshow state for opening modal
          modalBgIndex: 0,
          modalBgTimerId: null,
          // Countdown target and values
          eventTime: new Date("2025-10-24T10:00:00+08:00").getTime(),
          supabase: null,
          supabaseReady: false,
          baseDocumentTitle: document.title,
          guestName: "",
          guestGreeting: "Yth. Bapak/Ibu/Saudara/i",
          countdown: {
            days: "00",
            hours: "00",
            minutes: "00",
            seconds: "00",
          },
          commentForm: {
            name: "",
            message: "",
            attendance: "",
          },
          comments: [],
          galleryImages: [
            "assets/gallery/1.jpg",
            "assets/gallery/2.jpg",
            "assets/gallery/3.jpg",
            "assets/gallery/4.jpg",
            "assets/gallery/5.jpg",
            "assets/gallery/6.jpg",
            "assets/gallery/7.jpg",
            "assets/gallery/8.jpg",
            "assets/gallery/9.jpg",
            "assets/gallery/10.jpg",
            "assets/gallery/11.jpg",
            "assets/gallery/12.jpg",
          ],
          modalImages: [
            "assets/gallery/1.jpg",
            "assets/gallery/2.jpg",
            "assets/gallery/3.jpg",
            "assets/gallery/4.jpg",
            "assets/gallery/5.jpg",
            "assets/gallery/6.jpg",
            "assets/gallery/7.jpg",
            "assets/gallery/8.jpg",
            "assets/gallery/9.jpg",
            "assets/gallery/10.jpg",
          ],

          init() {
            // Initialize parallax effect
            this.initParallax();

            // Initialize AOS
            this.$nextTick(() => {
              AOS.init({
                duration: 900,
                once: true,
                offset: 80,
              });

              // Keep AOS measurements in sync with dynamic viewport and content
              const debouncedAOSRefresh = (() => {
                let timeoutId;
                return (hard = false) => {
                  clearTimeout(timeoutId);
                  timeoutId = setTimeout(() => {
                    if (hard && AOS.refreshHard) AOS.refreshHard();
                    else if (AOS.refresh) AOS.refresh();
                  }, 150);
                };
              })();

              window.addEventListener("resize", () => debouncedAOSRefresh());
              window.addEventListener("orientationchange", () =>
                debouncedAOSRefresh(true)
              );
              window.addEventListener("load", () => debouncedAOSRefresh(), {
                once: true,
              });
              if (document.fonts && document.fonts.ready) {
                document.fonts.ready.then(() => debouncedAOSRefresh());
              }
            });

            // Load comments from localStorage
            this.initSupabase();
            this.loadComments();

            // Start countdown
            this.updateCountdown();
            setInterval(() => this.updateCountdown(), 1000);

            // Handle smooth scrolling
            this.initSmoothScroll();

            // Personalize content based on URL guest parameter
            this.applyGuestPersonalization();

            // Start modal background slideshow if modal is visible
            if (this.showModal) {
              this.startModalSlideshow();
            }
          },

          startModalSlideshow() {
            if (this.modalBgTimerId) return;
            this.modalBgTimerId = setInterval(() => {
              this.modalBgIndex =
                (this.modalBgIndex + 1) % this.galleryImages.length;
            }, 500);
          },

          stopModalSlideshow() {
            if (this.modalBgTimerId) {
              clearInterval(this.modalBgTimerId);
              this.modalBgTimerId = null;
            }
          },

          initSupabase() {
            try {
              const url = document
                .querySelector('meta[name="supabase-url"]')
                ?.getAttribute("content")
                ?.trim();
              const anonKey = document
                .querySelector('meta[name="supabase-anon-key"]')
                ?.getAttribute("content")
                ?.trim();
              if (
                url &&
                anonKey &&
                window.supabase &&
                window.supabase.createClient
              ) {
                this.supabase = window.supabase.createClient(url, anonKey);
                this.supabaseReady = true;
              }
            } catch (e) {
              this.supabase = null;
              this.supabaseReady = false;
            }
          },

          initParallax() {
            const backLayer = document.querySelector(".back-layer");
            const frontLayer = document.querySelector(".front-layer");

            this.createSquare(backLayer, "back", "left", 20);
            this.createSquare(backLayer, "back", "right", 65);
            this.createSquare(frontLayer, "front", "left", 45);
            this.createSquare(frontLayer, "front", "right", 30);

            const layers = document.querySelectorAll(".parallax-layer");
            let ticking = false;

            const updateParallax = () => {
              const scrollY =
                window.scrollY ||
                window.pageYOffset ||
                document.documentElement.scrollTop ||
                0;
              const isCoarsePointer =
                window.matchMedia &&
                window.matchMedia("(pointer: coarse)").matches;
              const speedScale = isCoarsePointer ? 0.7 : 1;
              layers.forEach((layer) => {
                const baseSpeed = parseFloat(layer.dataset.speed) || 0.5;
                const speed = baseSpeed * speedScale;
                const yPos = -(scrollY * speed);
                layer.style.transform = `translate3d(0, ${yPos}px, 0)`;
              });
              ticking = false;
            };

            const requestTick = () => {
              if (!ticking) {
                window.requestAnimationFrame(updateParallax);
                ticking = true;
              }
            };

            // Use Scroll event with passive listeners; also update on resize and load to avoid jumps
            window.addEventListener("scroll", requestTick, { passive: true });
            window.addEventListener("resize", requestTick, { passive: true });
            window.addEventListener(
              "orientationchange",
              () => {
                ticking = false;
                updateParallax();
              },
              { passive: true }
            );
            updateParallax();
          },

          createSquare(layer, type, side, topPos) {
            const square = document.createElement("div");
            square.className = `square square-${side}`;
            if (type === "back") {
              square.style.backgroundImage = `url('https://media-public.canva.com/3gWYg/MAFB-W3gWYg/1/tl.png')`;
              square.style.opacity = "0.4";
              square.style.filter =
                "brightness(0) saturate(100%) invert(95%) sepia(64%) saturate(288%) hue-rotate(320deg) brightness(85%) contrast(85%)";
              const rotation = side === "left" ? -8 : 8;
              square.style.transform = `rotate(${rotation}deg)`;
            } else {
              square.style.backgroundImage = `url('https://media-public.canva.com/EalrA/MAEchNEalrA/1/tl.png')`;
              square.style.opacity = "0.9";
              square.style.filter = "grayscale(100%)";
              square.style.transform = "none";
            }
            square.style.top = `${topPos}%`;
            layer.appendChild(square);
          },

          openInvitation() {
            this.stopModalSlideshow();
            this.showModal = false;
            window.scrollTo({ top: 0, behavior: "smooth" });
            this.$nextTick(() => {
              if (window.AOS && AOS.refresh) AOS.refresh();

              // Start playing music when invitation is opened
              const audioPlayer = this.$refs.audioPlayer;
              if (audioPlayer) {
                audioPlayer.play().catch(() => {});
                this.isPlaying = true;
              }
            });
          },

          toggleAudio() {
            const audioPlayer = this.$refs.audioPlayer;

            if (this.isPlaying) {
              audioPlayer.pause();
            } else {
              audioPlayer.play().catch(() => {});
            }
            this.isPlaying = !this.isPlaying;
          },

          updateCountdown() {
            const now = Date.now();
            let diff = this.eventTime - now;
            if (diff < 0) diff = 0;

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor(
              (diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)
            );
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            this.countdown = {
              days: String(days).padStart(2, "0"),
              hours: String(hours).padStart(2, "0"),
              minutes: String(minutes).padStart(2, "0"),
              seconds: String(seconds).padStart(2, "0"),
            };
          },

          submitComment() {
            if (!this.commentForm.name || !this.commentForm.message) {
              alert("Mohon isi nama dan ucapan.");
              return;
            }

            const newComment = {
              name: this.commentForm.name,
              message: this.commentForm.message,
              attendance: this.commentForm.attendance || "Belum Tahu",
              time: new Date().toISOString(),
            };

            this.comments.push(newComment);
            this.saveComments();

            // Reset form
            this.commentForm = {
              name: "",
              message: "",
              attendance: "",
            };

            alert("Terima kasih atas ucapan dan konfirmasi Anda!");
          },

          async loadComments() {
            // Try Supabase first if configured
            if (this.supabase) {
              try {
                const { data, error } = await this.supabase
                  .from("pesan") // Changed from 'comments' to 'pesan'
                  .select("*")
                  .order("time", { ascending: true });
                if (!error && Array.isArray(data)) {
                  this.comments = data;
                  // keep a local cache for offline
                  try {
                    localStorage.setItem(
                      "metatah_pesan_v1",
                      JSON.stringify(this.comments)
                    );
                  } catch (_) {}
                  return;
                }
              } catch (_) {
                // fall back to localStorage
              }
            }
            // Fallback: load from localStorage
            try {
              this.comments =
                JSON.parse(localStorage.getItem("metatah_pesan_v1")) || [];
            } catch (_) {
              this.comments = [];
            }
          },

          async saveComments() {
            // always keep offline copy
            try {
              localStorage.setItem(
                "metatah_pesan_v1",
                JSON.stringify(this.comments)
              );
            } catch (_) {}

            // if supabase configured, insert the latest comment
            if (this.supabase) {
              const latest = this.comments[this.comments.length - 1];
              if (latest) {
                try {
                  await this.supabase.from("pesan").insert([latest]); // Changed from 'comments' to 'pesan'
                } catch (_) {
                  // ignore errors; offline-first
                }
              }
            }
          },

          openLightbox(index) {
            this.currentImageIndex = index;
            this.showLightbox = true;
            // Prevent body scroll when lightbox is open
            document.body.style.overflow = "hidden";
          },

          closeLightbox() {
            this.showLightbox = false;
            // Restore body scroll
            document.body.style.overflow = "";
          },

          nextImage() {
            this.currentImageIndex =
              (this.currentImageIndex + 1) % this.galleryImages.length;
          },

          prevImage() {
            this.currentImageIndex =
              (this.currentImageIndex - 1 + this.galleryImages.length) %
              this.galleryImages.length;
          },

          initSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach((a) => {
              a.addEventListener("click", (e) => {
                const id = a.getAttribute("href").slice(1);
                const el = document.getElementById(id);
                if (el) {
                  e.preventDefault();
                  const top =
                    el.getBoundingClientRect().top + window.pageYOffset - 90;
                  window.scrollTo({ top, behavior: "smooth" });
                }
              });
            });
          },

          normalizeGuestName(rawValue) {
            try {
              const decoded = decodeURIComponent(String(rawValue || ""))
                .replace(/\+/g, " ")
                .replace(/[\-_]+/g, " ")
                .replace(/\s+/g, " ")
                .trim();
              if (!decoded) return "";
              return decoded
                .split(" ")
                .map((part) =>
                  part.length > 0
                    ? part.charAt(0).toUpperCase() + part.slice(1)
                    : part
                )
                .join(" ");
            } catch (_) {
              return "";
            }
          },

          parseGuestFromUrl() {
            let rawGuest = "";
            try {
              const url = new URL(window.location.href);
              rawGuest =
                url.searchParams.get("to") ||
                url.searchParams.get("guest") ||
                url.searchParams.get("nama") ||
                "";

              if (!rawGuest && window.location.hash) {
                const hash = window.location.hash.replace(/^#/, "");
                const params = new URLSearchParams(hash);
                rawGuest =
                  params.get("to") ||
                  params.get("guest") ||
                  params.get("nama") ||
                  "";
              }

              if (!rawGuest) {
                const segments = window.location.pathname
                  .split("/")
                  .filter(Boolean);
                // Support path like /guest/<name> or /g/<name>
                const idx = Math.max(
                  segments.lastIndexOf("guest"),
                  segments.lastIndexOf("g")
                );
                if (idx >= 0 && segments[idx + 1]) {
                  rawGuest = segments[idx + 1];
                }
              }
            } catch (_) {
              rawGuest = "";
            }

            return this.normalizeGuestName(rawGuest);
          },

          updateOgTitle(newTitle) {
            const ogTitle = document.querySelector('meta[property="og:title"]');
            if (ogTitle) ogTitle.setAttribute("content", newTitle);
          },

          applyGuestPersonalization() {
            const parsed = this.parseGuestFromUrl();
            if (parsed) {
              this.guestName = parsed;
              this.guestGreeting = `Yth. ${parsed}`;
              const personalizedTitle = `Undangan untuk ${parsed} — Undangan Metatah`;
              document.title = personalizedTitle;
              this.updateOgTitle(personalizedTitle);
            } else {
              this.guestName = "";
              this.guestGreeting =
                this.guestGreetingDefault || "Yth. Bapak/Ibu/Saudara/i";
              document.title = this.baseDocumentTitle || document.title;
            }
          },
        };
      }
    </script>

    <!-- FOOTER -->
    <footer
      class="bg-white/20 backdrop-blur-sm h-24 mb-12 flex items-center justify-center text-center relative pt-8 pb-20"
    >
      <div class="container mx-auto px-6">
        <p class="text-gray-600 text-md">
          Made with <span id="love-emoji" class="text-red-500">❤</span> by
          <a
            href="https://www.instagram.com/dwpyn"
            target="_blank"
            rel="noopener noreferrer"
            class="text-secondary-dark font-semibold hover:text-secondary transition-colors duration-200"
          >
            @dwpyn
          </a>
        </p>
      </div>
    </footer>
    <script>
      // Collection of love emojis
      const loveEmojis = [
        "❤️",
        "💕",
        "💖",
        "💗",
        "💓",
        "💞",
        "💝",
        "💘",
        "💟",
        "❣️",
        "💌",
      ];

      // Get the emoji element
      const loveEmojiElement = document.getElementById("love-emoji");

      // Initialize current emoji index
      let currentEmojiIndex = 0;

      // Function to change the emoji
      function changeEmoji() {
        currentEmojiIndex = (currentEmojiIndex + 1) % loveEmojis.length;
        loveEmojiElement.textContent = loveEmojis[currentEmojiIndex];
      }

      // Change emoji every 0.5 seconds
      setInterval(changeEmoji, 300);
    </script>
  </body>
</html>
